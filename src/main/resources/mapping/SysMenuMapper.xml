<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.hallth.mapper.SysMenuMapper" >
  <sql id="Base_Column_List" >
    menu.ID as "id",
    menu.SYS_ID as "sysId",
    sys.SYS_NAME as "sysName",
    menu.MENU_NAME as "menuName",
    menu.MENU_ICON as "menuIcon",
    menu.MENU_URL as "menuUrl",
    menu.REMARKS as "remarks",
    menu.HIDDEN as "hidden",
    menu.IS_AVAILABLE as "isAvailable",
    menu.PARENT_ID as "parentId",
    menu.MENU_FLAG as "menuFlag",
    dict1.value as "hiddenCn",
    dict2.value as "isAvailableCn",
    pMenu.menu_name as "parentMenuName",
    pMenu.menu_flag as "parentMenuFlag"
  </sql>
  <sql id="leftJoin">
    left join sys_dictionary dict1 on dict1.type = 'YES_NO' and dict1.key = menu.HIDDEN
    left join sys_dictionary dict2 on dict2.type = 'YES_NO' and dict2.key = menu.IS_AVAILABLE
    left join sys_menu pMenu on pMenu.ID = menu.PARENT_ID
    left join system_info sys on sys.id = menu.sys_id
  </sql>

  <select id="getMenuList" resultType="com.hallth.domain.SysMenu" parameterType="com.hallth.domain.SysMenu">
    select
    <include refid="Base_Column_List"/>
    from sys_menu  menu
    <include refid="leftJoin"/>
    <where>
      <if test="sysId != null and sysId != 0">
        and menu.sys_id = #{sysId, jdbcType=INTEGER}
      </if>
      <if test="sysName != null and sysName != ''">
        and sys.SYS_NAME like '%' || #{sysName, jdbcType=VARCHAR} || '%'
      </if>
      <if test="menuName != null and menuName != ''">
        and menu.MENU_NAME like '%' || #{menuName, jdbcType=VARCHAR} || '%'
      </if>
      <if test="parentId != null">
        and menu.PARENT_ID = #{parentId, jdbcType=INTEGER}
      </if>
    </where>
    order by menu.ID
    limit #{startRow}, #{pageSize}
  </select>

  <select id="getCountMenuList" resultType="java.lang.Integer" parameterType="com.hallth.domain.SysMenu">
    select
    count(*)
    from sys_menu  menu
    <where>
      <if test="sysId != null">
        and menu.sys_id = #{sysId, jdbcType=INTEGER}
      </if>
      <if test="sysName != null and sysName != ''">
        and sys.SYS_NAME like '%' || #{sysName, jdbcType=VARCHAR} || '%'
      </if>
      <if test="menuName != null and menuName != ''">
        and menu.MENU_NAME like '%' || #{menuName, jdbcType=VARCHAR} || '%'
      </if>
    </where>
  </select>

  <select id="getChildrenMenuList" resultType="com.hallth.domain.SysMenu" parameterType="com.hallth.domain.SysMenu">
    select
    <include refid="Base_Column_List"/>
    from sys_menu  menu
    <include refid="leftJoin"/>
    where menu.IS_AVAILABLE = '1'
        and menu.PARENT_ID = #{parentId, jdbcType=INTEGER}
    order by menu.ID
  </select>
</mapper>